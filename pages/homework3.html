<!DOCTYPE html>
<html>
    <head>
        <title>Statistics</title>
        <meta http-equiv='cache-control' content='no-cache'> 
        <meta http-equiv='expires' content='0'> 
        <meta http-equiv='pragma' content='no-cache'>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>
    <body>
        <h1>Esercizio 1</h1>
        <h4>Part a</h4>
        <h5>M systems are subject to a series of N attacks. On the x-axis, we indicate the attacks and <br> on the Y-axis we
            simulate the accumulation of a "security score" (-1, 1), where the score is -1 if the system is penetrated <br>
            and 1 if the system was successfully "shielded" or protected. <br> Simulate the score "trajectories" for all systems,
            assuming, for simplicity, a constant penetration probability p at each attack.</h5>
        <p>Clicca sul pulsante per eseguire la simulazione:</p>
        <form id="inputForm">
            <label for="numSystems">Numero di Sistemi:</label>
            <input type="number" id="numSystems" min="1" value="10"><br>
    
            <label for="numAttacks">Numero di Attacchi:</label>
            <input type="number" id="numAttacks" min="1" value="20"><br>
    
            <label for="penetrationProbability">Probabilità di Penetrazione (0-1):</label>
            <input type="number" id="penetrationProbability" step="0.01" min="0" max="1" value="0.2"><br>
            
            <button id="simulateButton">Simula</button>
        </form>

        <div id="chartContainer" style="width: 800px; height: 400px;">
            <canvas id="securityChart"></canvas>
        </div>
        
        <script>
            // Definisci la funzione per simulare i punteggi di sicurezza
            function simulateSecurityScoreTrajectories(M, N, p, T) {
                    const scoreTrajectories = [];

                    for (let trial = 0; trial < T; trial++) {
                        const trialScores = [];

                        for (let system = 0; system < M; system++) {
                            let systemScore = 1;
                            const systemTrajectory = [];

                            for (let attack = 0; attack < N; attack++) {
                                if (Math.random() <= p) {
                                    systemScore = -1;
                                }

                                systemTrajectory.push(systemScore);
                            }

                            trialScores.push(systemTrajectory);
                        }

                        scoreTrajectories.push(trialScores);
                    }

                    return scoreTrajectories;
            }
    
            const simulateButton = document.getElementById('simulateButton');
                simulateButton.addEventListener('click', function () {
                const numSystems = parseInt(document.getElementById('numSystems').value, 10);
                const numAttacks = parseInt(document.getElementById('numAttacks').value, 10);
                const penetrationProbability = parseFloat(document.getElementById('penetrationProbability').value);
                const T = 1000; // Numero di simulazioni

                // Esegui la simulazione
                const scoreTrajectories = simulateSecurityScoreTrajectories(numSystems, numAttacks, penetrationProbability, T);

                // Prepara i dati per il grafico
                const labels = Array.from({ length: numAttacks }, (_, i) => `Attacco ${i + 1}`);

                const datasets = scoreTrajectories.map((systemTrajectories, systemIndex) => {
                    return {
                        label: `Sistema ${systemIndex + 1}`,
                        data: systemTrajectories[0].map((_, i) => systemTrajectories.reduce((acc, trial) => acc + trial[i], 0)),
                        fill: false,
                    };
                });

                // Crea e visualizza il grafico solo dopo che il documento è stato caricato
                document.addEventListener("DOMContentLoaded", function () {
                    const ctx = document.getElementById('securityChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: datasets,
                        },
                    });
                });
            });
        </script>

        <br><br>
        <h4>Part b</h4>
        <h5>Same as before, but simulate the cumulated frequency, say f, of penetration. <br> Do the same with the relative
            frequency f/number of attacks and the "normalized" ratio: f/ √number of attacks. <br>
            For any of the above 4 charts (which will be actually an instance of a unique "object", from a coder's point of view), plot <br>
            a vertical histogram at some point x (day or attack number, user parameter) and at the last abscissa <br>
            value and make your personal considerations on the shape of the distributions. <br>
            Make sure that each animation is enclosed into a "frame" (a rectangle) resizable by the user, by using the mouse <br>
            (you can make a separate, reusable, "ResizableRectangle" object for that).</h5>
    </body>
</html>