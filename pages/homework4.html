<!DOCTYPE html>
<html>
    <head>
        <title>Statistics</title>
        <meta http-equiv='cache-control' content='no-cache'> 
        <meta http-equiv='expires' content='0'> 
        <meta http-equiv='pragma' content='no-cache'>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    </head>
    <body>
        <h5>Since most of the programs you created about the distributions were wrong, we will do a "revision", <br>
            due to the importance of the distribution concept. <br>
            Revise and optimize you previous programs to compute the joint distribution of any number of 2,3, ...k, <br>
            continuous quantitative variables where, for each variable, the user can specify the number of subdivisions <br>
            ("class intervals") of a range containing the observed values.</h5> <br>
            
        <form action="#" method="post" enctype="multipart/form-data">
            <label for="xlsxFile">Upload XLSX file:</label>
            <input type="file" id="xlsxFile" name="xlsxFile" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"><br><br>
            <input type="submit" value="Submit" id="submitButton" onclick="handleSubmit(event)">
        </form><br><br>
        
        <div id="buttons"></div>
        <div id="output">
            <p>The possibile variables will appear here.</p>
        </div><br><br>
        <div id="frequencyTable">
            <p>The frequency table will appear here.</p>
        </div><br><br>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.8/xlsx.full.min.js"></script>
        <script>
            const selectedNames = new Set();
            let data = [];
        
            function handleFileSelect(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    data = [];
        
                    const dataFromXLSX = XLSX.read(event.target.result, { type: 'binary' });
                    const sheetName = dataFromXLSX.SheetNames[0];
                    const worksheet = dataFromXLSX.Sheets[sheetName];
                    data = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    createButtons();
                };
                reader.readAsBinaryString(file);
            }
        
            function createButtons() {
                const header = data[0];
        
                const buttons = header.map(cell => {
                    const button = document.createElement('button');
                    button.textContent = cell;
                    button.addEventListener('click', () => toggleText(cell));
                    return button;
                });
        
                const buttonsContainer = document.getElementById('buttons');
                buttons.forEach(button => buttonsContainer.appendChild(button));
            }
        
            function toggleText(text) {
                const outputElement = document.getElementById('output');
                if (selectedNames.has(text)) {
                    selectedNames.delete(text);
                } else {
                    selectedNames.add(text);
                }
        
                const selectedNamesArray = Array.from(selectedNames);
                outputElement.textContent = selectedNamesArray.join(', ');
            }
        
            function handleSubmit(event) {
                event.preventDefault(); // Prevent form submission
                computeFrequencyDistribution();
            }
        
            document.getElementById('xlsxFile').addEventListener('change', handleFileSelect, false);
        
            function computeFrequencyDistribution() {
                const frequencyTable = document.getElementById('frequencyTable');
                frequencyTable.innerHTML = ''; // Clear the previous table
        
                if (selectedNames.size > 0) {
                    const header = data[0];
                    const selectedColumnIndices = header
                        .map((columnName, index) => selectedNames.has(columnName) ? index : -1)
                        .filter(index => index !== -1);
        
                    const jointFrequency = new Map();
        
                    for (const row of data.slice(1)) {
                        const selectedRowValues = selectedColumnIndices.map(index => row[index]);
                        const key = selectedRowValues.join('|');
                        jointFrequency.set(key, (jointFrequency.get(key) || 0) + 1);
                    }
        
                    const table = document.createElement('table');
                    table.innerHTML = `<tr><th>Variables</th><th>Absolute Frequency</th><th>Relative Frequency</th><th>Percentage Frequency</th></tr>`;
        
                    for (const [key, count] of jointFrequency) {
                        const relative = count / (data.length - 1);
                        const percentage = (relative * 100).toFixed(2);
                        table.innerHTML += `<tr><td>${key}</td><td>${count}</td><td>${relative.toFixed(2)}</td><td>${percentage}%</td></tr>`;
                    }
        
                    frequencyTable.appendChild(table);
                }
            }
        </script> 

        <h4>C# program</h4>
        <pre>
            <code>
                using System;
                using System.Collections.Generic;
                using System.IO;
                using System.Linq;

                class Program
                {
                    static void Main()
                    {
                        string projectDirectory = "YOUR PROJECT DIRECTORY";
                        
                        string degreesPath = Path.Combine(projectDirectory, "degrees.txt");
                        string ambitiousnessPath = Path.Combine(projectDirectory, "ambitiousness.txt");
                        string heightsPath = Path.Combine(projectDirectory, "heights.txt");

                        string degreesData = File.ReadAllText(degreesPath);
                        string ambitiousnessData = File.ReadAllText(ambitiousnessPath);
                        string heightsData = File.ReadAllText(heightsPath);

                        Dictionary heightsFrequencies = CalculateFrequencies(heightsData);
                        PrintFrequencies(heightsFrequencies, "---Height Frequencies---");

                        Dictionary degreesFrequencies = CalculateFrequencies(degreesData);
                        PrintFrequencies(degreesFrequencies, "---Background Degree Frequencies---");

                        Dictionary ambitiousnessFrequencies = CalculateFrequencies(ambitiousnessData);
                        PrintFrequencies(ambitiousnessFrequencies, "---Ambitious Values Frequencies---");

                        List dataArrays = new List
                        {
                            ambitiousnessData.Split('\n'),
                            heightsData.Split('\n')
                        };

                        Dictionary jointDistribution = CalculateJointDistribution(dataArrays);
                        PrintJointDistribution(jointDistribution, "---Joint Distribution of Ambitiousness and Height (Data: A | H)---");

                        dataArrays.Add(degreesData.Split('\n'));

                        Dictionary jointDistributions = CalculateJointDistribution(dataArrays);
                        PrintJointDistribution(jointDistributions, "---Joint Distribution OF 3 VARIABLES---");
                    }

                    static Dictionary CalculateFrequencies(string text)
                    {
                        var frequencies = new Dictionary();
                        var lines = text.Split('\n');

                        foreach (var line in lines)
                        {
                            var item = line.ToLower().Trim();

                            if (frequencies.ContainsKey(item))
                            {
                                frequencies[item]++;
                            }
                            else
                            {
                                frequencies[item] = 1;
                            }
                        }

                        return frequencies;
                    }

                    static void PrintFrequencies(Dictionary frequencies, string title)
                    {
                        Console.WriteLine($"\n{title}\n");
                        int total = frequencies.Values.Sum();

                        foreach (var item in frequencies)
                        {
                            double relativeFrequency = (double)item.Value / total;
                            double percentage = relativeFrequency * 100;
                            Console.WriteLine($"{item.Key}: {item.Value} (Relative: {relativeFrequency:F2}, Percentage: {percentage:F2}%)");
                        }
                    }

                    static Dictionary CalculateJointDistribution(List dataArrays)
                    {
                        var jointDistribution = new Dictionary();
                        int numVariables = dataArrays.Count;

                        for (int i = 0; i < dataArrays[0].Length; i++)
                        {
                            var values = dataArrays.Select(dataArray => dataArray[i].ToLower().Trim()).ToList();
                            var key = string.Join("|", values);

                            if (jointDistribution.ContainsKey(key))
                            {
                                jointDistribution[key]++;
                            }
                            else
                            {
                                jointDistribution[key] = 1;
                            }
                        }

                        return jointDistribution;
                    }

                    static void PrintJointDistribution(Dictionary jointDistribution, string title)
                    {
                        Console.WriteLine($"\n{title}\n");
                        int total = jointDistribution.Values.Sum();

                        foreach (var item in jointDistribution)
                        {
                            var values = item.Key.Split('|');
                            double relativeFrequency = (double)item.Value / total;
                            double percentage = relativeFrequency * 100;
                            Console.WriteLine($"Data: {string.Join(", ", values)} \t Frequency: {item.Value}, Relative Frequency: {relativeFrequency:F2}, Percentage: {percentage:F2}%");
                        }
                    }
                }

            </code>
        </pre>

        